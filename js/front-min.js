YUI().use("node","event","io","node-scroll-info","handlebars","json-parse","jsonp","jsonp-url","gallery-idletimer",function(e){"use strict";function h(){e.log("onFailure")}function p(){h()}function d(e){e.preventDefault(),g()}function v(){this.get("region").top-f<n.get("winHeight")&&g()}function m(t){t.preventDefault();var n=t.currentTarget,r=e.one(".pure-input");location.href=n.get("action")+"/"+r.get("value")}function g(){var i=0,s=0,o=0,l=0,c;if(n.hasClass("io-done"))return;i=parseInt(r.getAttribute("data-numfound"),10),s=parseInt(r.getAttribute("data-start"),10),o=parseInt(r.getAttribute("data-docslength"),10),l=s+o,l<=i&&(c=t+"&start="+l,e.Array.indexOf(u,c)<0&&!n.hasClass("io-loading")&&(n.scrollInfo.getScrollInfo().atBottom||e.IdleTimer.isIdle()&&a.get("region").top-f<n.get("winHeight"))&&(n.addClass("io-loading"),e.jsonp(c,{on:{success:y,failure:h,timeout:p},timeout:3e3})))}function y(t){try{var i=parseInt(t.response.numFound,10),o=parseInt(t.response.start,10),a=parseInt(t.response.docs.length,10);u.push(this.url),r.setAttribute("data-numFound",i),r.setAttribute("data-start",o),r.setAttribute("data-docsLength",a),r.append(c({items:t.response.docs})),o+a===i&&n.addClass("io-done"),n.removeClass("io-loading"),s.removeClass("pure-button-disabled")}catch(f){e.log("error")}}var t="http://dev-discovery.dlib.nyu.edu:8080/solr3_discovery/nyupress/select?&wt=json&json.wrf=callback={callback}&hl=true&hl.fl=title,description,text&fl=title,description,author,identifier,coverHref",n=e.one("body"),r=e.one("#a"),i=e.one(".query"),s=e.one(".pure-button.loading"),o="*:*",u=[],a=e.one("ul.pure-paginator"),f=200,l=e.one("#list-template").getHTML(),c=e.Handlebars.compile(l);e.IdleTimer.subscribe("idle",g),e.IdleTimer.start(5e3),n.plug(e.Plugin.ScrollInfo,{scrollMargin:f}),n.scrollInfo.on({scroll:g}),e.jsonp(t,{on:{success:y,failure:h,timeout:p},timeout:3e3}),s.on("click",d),n.delegate("submit",m,"form"),a.on("available",v)});
