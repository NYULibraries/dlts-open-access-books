YUI().use("node","event","io","node-scroll-info","handlebars","json-parse","jsonp","jsonp-url","gallery-idletimer",function(e){"use strict";function v(){e.io("../404.html",{on:{success:function(e,t){r.append(t.response)}}})}function m(){v()}function g(e,t){n.addClass("io-loading")}function y(e,t){n.removeClass("io-loading")}function b(e){e.preventDefault(),E()}function w(){this.get("region").top-l<n.get("winHeight")&&E()}function E(i){var s=parseInt(r.getAttribute("data-numfound"),10),c=parseInt(r.getAttribute("data-start"),10),h=parseInt(r.getAttribute("data-docslength"),10);c+h<s&&(a=t+encodeURIComponent(o)+"&start="+(c+h+1),e.Array.indexOf(u,a)<0&&!n.hasClass("io-loading")&&(n.scrollInfo.getScrollInfo().atBottom||e.IdleTimer.isIdle()&&f.get("region").top-l<n.get("winHeight"))&&e.jsonp(a,{on:{success:S,failure:v,start:g,end:y,timeout:m},timeout:3e3}))}function S(t){try{u.push(a),r.setAttribute("data-numFound",t.response.numFound),r.setAttribute("data-start",t.response.start),r.setAttribute("data-docsLength",t.response.docs.length),s.set("text",t.response.numFound),s.removeClass("hidden"),e.each(t.response.docs,function(e,n){t.highlighting&&t.highlighting[e.identifier].description?t.response.docs[n].slash=t.highlighting[e.identifier].description[0]:t.response.docs[n].slash=t.response.docs[n].description}),r.append(d({items:t.response.docs}))}catch(n){e.log("error")}}var t="http://dev-discovery.dlib.nyu.edu:8080/solr3_discovery/nyupress/select?&wt=json&json.wrf=callback={callback}&hl=true&hl.fl=title,description,text&q=",n=e.one("body"),r=e.one("#a"),i=e.one(".query"),s=e.one(".total-found"),o="*:*",u=[],a,f=e.one("ul.pure-paginator"),l=200,c=/\/search\/(.*)/,h=location.pathname.match(c),p=e.one("#list-template").getHTML(),d=e.Handlebars.compile(p),p=e.one("#list-template").getHTML(),d=e.Handlebars.compile(p);e.IdleTimer.subscribe("idle",E),e.IdleTimer.start(5e3),n.plug(e.Plugin.ScrollInfo,{scrollMargin:l}),n.scrollInfo.on({scroll:E}),e.on("available",w,"ul.pure-paginator"),e.on("io:start",g),e.on("io:success",S),e.on("io:failure",v),e.on("io:end",y),n.delegate("click",b,".pager-next a"),h&&h[1]?(o=h[1].toLowerCase(),i.set("text",o)):i.set("text","All titles"),a=t+encodeURIComponent(o),e.jsonp(a,{on:{success:S,failure:v,start:g,end:y,timeout:m},timeout:3e3})});
