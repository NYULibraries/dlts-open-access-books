YUI().use("node","event","io","node-scroll-info","handlebars","json-parse","jsonp","jsonp-url","gallery-idletimer",function(e){"use strict";function m(){e.log("onFailure")}function g(){m()}function y(e){e.preventDefault(),E()}function b(){this.get("region").top-c<n.get("winHeight")&&E()}function w(t){t.preventDefault();var n=t.currentTarget,r=e.one(".pure-input");location.href=n.get("action")+"/"+r.get("value")}function E(i){if(n.hasClass("io-done"))return;var o=parseInt(r.getAttribute("data-numfound"),10),h=parseInt(r.getAttribute("data-start"),10),p=parseInt(r.getAttribute("data-docslength"),10);h+p<=o&&(f=t+u+"&start="+(h+p),e.Array.indexOf(a,f)<0&&!n.hasClass("io-loading")&&(n.scrollInfo.getScrollInfo().atBottom||e.IdleTimer.isIdle()&&l.get("region").top-c<n.get("winHeight"))&&(n.addClass("io-loading"),s.addClass("pure-button-disabled"),e.jsonp(f,{on:{success:S,failure:m,timeout:g},timeout:3e3})))}function S(t){try{var i=parseInt(t.response.numFound,10),u=parseInt(t.response.start,10),f=parseInt(t.response.docs.length,10);a.push(this.url),r.setAttribute("data-numFound",i),r.setAttribute("data-start",u),r.setAttribute("data-docsLength",f),o.set("text",t.response.numFound),o.removeClass("hidden"),e.each(t.response.docs,function(e,n){t.highlighting&&t.highlighting[e.identifier].description?t.response.docs[n].slash=t.highlighting[e.identifier].description[0]:t.response.docs[n].slash=t.response.docs[n].description}),r.append(v({items:t.response.docs})),u+f===i&&n.addClass("io-done"),n.removeClass("io-loading"),s.removeClass("pure-button-disabled")}catch(l){e.log("error")}}var t="http://dev-discovery.dlib.nyu.edu:8080/solr3_discovery/nyupress/select?&wt=json&json.wrf=callback={callback}&hl=true&hl.fl=title,description,text&fl=title,description,author,identifier,coverHref&q=",n=e.one("body"),r=e.one("#a"),i=e.one(".query"),s=e.one(".pure-button.loading"),o=e.one(".total-found"),u="*:*",a=[],f,l=e.one("ul.pure-paginator"),c=200,h=/\/search\/(.*)/,p=location.pathname.match(h),d=e.one("#list-template").getHTML(),v=e.Handlebars.compile(d);e.IdleTimer.subscribe("idle",E),e.IdleTimer.start(5e3),n.plug(e.Plugin.ScrollInfo,{scrollMargin:c}),n.scrollInfo.on({scroll:E}),e.on("available",b,"ul.pure-paginator"),p&&p[1]?(u=p[1].toLowerCase(),i.set("text",u)):i.set("text","All titles"),f=t+encodeURIComponent(u),e.jsonp(f,{on:{success:S,failure:m,timeout:g},timeout:3e3}),s.on("click",y),n.delegate("submit",w,"form")});
